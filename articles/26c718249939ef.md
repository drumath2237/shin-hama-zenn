---
title: "Yolo と Segment Anything Model による自動アノテーション"
emoji: "🔥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["yolo", "segmentation", "annotation", "object detection"]
published: false
---

物体検出モデルを作るときに最も大変な作業はなんといってもアノテーションです。
ここでアノテーションとは、画像中の物体の位置やクラスを示すための情報を付与する作業を指します。
従来アノテーションを行うためには、LabelMe などのアプリを使って画像を開いて物体の位置を示す矩形を描き、その矩形に対応するクラスを選択するという作業を繰り返す必要がありました。

しかし最近では、Yolo と Segment Anything Model (以下 SAM) というモデルを組み合わせることで、このアノテーション作業を自動化することが可能になりました。
この記事では、Yolo と SAM を使って自動アノテーションを行う方法について解説します。

## Yolo と SAM とは

Yolo は、物体検出モデルの一つで、画像中の物体の位置とクラスを同時に推定することができるモデルです。
詳細な説明は他の記事に譲りますが、以下の画像のようなことができます。

![example of object detection by yolo](/images/yolo-sam-annotation/example_yolo.png.png)

一方 SAM は Meta 社が開発したセグメンテーションモデルの一つで、画像中の領域を検出できるモデルです。
SAM のすごいところは、大規模なデータセットで事前学習を行ったことで、未知の画像データに対しても高い精度でセグメンテーションを行うことができる点です。
こちらは実際にデモサイトを見てもらうのが一番わかりやすいと思います。

https://segment-anything.com/demo

## 自動アノテーションの仕組み



## 自動アノテーションの手順

自動アノテーションには Yolo が提供する `auto_annotator` を利用します。
こちらに画像を保存しているディレクトリと物体検出･セグメンテーション用のモデルを指定することで、自動アノテーションを行うことができます。

https://docs.ultralytics.com/ja/reference/data/annotator/

```python
from ultralytics.data.annotator import auto_annotate

auto_annotate(data='path/to/assets_dir', det_model='yolov8n.pt', sam_model='sam_b.pt')
```

各パラメータの説明は以下のとおりです。

| 名称       | タイプ         | 説明                                                                                          | デフォルト   |
| ---------- | -------------- | --------------------------------------------------------------------------------------------- | ------------ |
| data       | str            | 注釈を付ける画像を含むフォルダへのパス。                                                      | 必須         |
| det_model  | str            | 事前に訓練されたYOLO 検出モデル。デフォルトは 'yolov8x.pt' です。                             | 'yolov8x.pt' |
| sam_model  | str            | 事前に訓練されたSAM セグメンテーションモデル。デフォルトは 'sam_b.pt' です。                  | 'sam_b.pt'   |
| device     | str            | モデルを実行するデバイス。デフォルトは空の文字列（利用可能な場合はCPUまたはGPU）。            | ''           |
| output_dir | str    \| None | 注釈付き結果を保存するディレクトリ。 デフォルトは'data'と同じディレクトリの'labels'フォルダ。 | None         |
